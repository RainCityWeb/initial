# Chat Notes - December 12, 2025

## The Big Goal

**Build a "factory" for spitting out very simple, mobile-optimised websites for small businesses.**

---

## What We Built (Phase 1)

A complete, production-ready template for small business websites:

```
misc-small-biz-site/
├── src/
│   ├── _data/site.json      ← All content lives here (CMS edits this)
│   ├── _includes/
│   │   ├── base.njk         ← Base layout
│   │   └── sections/        ← 6 reusable partials
│   ├── css/style.css        ← Tailwind v4 + custom theme
│   └── index.njk            ← Main page
├── admin/
│   ├── index.html           ← CMS entry point
│   └── config.yml           ← CMS field definitions
├── .nvmrc                   ← Node 20 pinned
├── .eleventy.js             ← 11ty config
├── netlify.toml             ← Netlify deployment
└── package.json             ← Scripts + deps
```

---

## Tech Stack

| Layer | Choice | Why |
|-------|--------|-----|
| **Generator** | 11ty (Eleventy) | Simple, fast, reusable templates |
| **Styling** | Tailwind CSS v4 | Utility-first, consistent across sites |
| **CMS** | Decap CMS + Netlify Identity | Free, embedded `/admin`, no backend to host |
| **Hosting** | Netlify | Auto-deploy, Identity integration |
| **Node** | v20 LTS (pinned via `.nvmrc`) | Consistency |

---

## Template Sections

All configurable via `site.json`:

1. **Hero** — business name, tagline, CTAs
2. **About** — description + optional highlights
3. **Services** — list with icons (emoji)
4. **Hours** — daily opening times
5. **Location** — address + embedded Google Map
6. **Contact** — phone, email, social links
7. **Footer** — copyright, social icons

---

## Key Features

- ✅ **100% configurable** — zero hardcoded content in templates
- ✅ **Mobile-first** — responsive Tailwind CSS
- ✅ **Accessible** — WCAG contrast, aria-labels, iframe titles
- ✅ **CMS-ready** — Decap admin at `/admin`
- ✅ **Local testing** — `npm run dev:cms` runs CMS proxy
- ✅ **Minimal GA** — just add ID to config

---

## Commands

```bash
npm run dev        # Dev server (no CMS)
npm run dev:cms    # Dev server + CMS proxy (localhost:8080/admin)
npm run build      # Production build
```

---

## How CMS Works Locally

```
Browser → Decap CMS UI → Proxy (port 8081) → site.json → 11ty rebuild → Hot reload
```

In production: Proxy replaced by Netlify Identity + Git Gateway (commits to repo).

---

## Next Steps (Phase 2)

- [ ] Create GitHub org for client repos
- [ ] **Create bot GitHub account** (e.g., `raincityweb-bot`) for CMS commits
- [ ] Deploy first site to Netlify
- [ ] Enable Identity + Git Gateway (use bot's PAT)
- [ ] Extract as a starter template
- [ ] Build CLI tool: `create-biz-site --name "Bob's Plumbing"`

---

## Security Notes

| Concern | Mitigation |
|---------|------------|
| Who can access `/admin`? | Netlify Identity — invite only |
| Can clients edit other sites? | No — Identity is per-site isolated |
| Who owns commits? | Use bot account PAT for Git Gateway |
| Can clients push arbitrary code? | No — Git Gateway only allows CMS-defined files |
| What if content is messed up? | Everything is git history — revert anytime |

---

## Deployment Model (Decided)

| Aspect | Decision |
|--------|----------|
| **Hosting** | One Netlify account (yours) |
| **Repos** | Dedicated GitHub org |
| **Client access** | Netlify Identity → `/admin` only |
| **Domains** | Client provides, you configure |
| **Isolation** | Identity is per-site (clients can't see other sites) |

**Workflow for new client:**
1. Clone template repo into your org
2. Update `site.json` + colors
3. Connect to Netlify → auto-builds
4. Enable Identity → invite client email
5. Add custom domain (client provides)
6. Hand off: "Log in at yoursite.com/admin"

---

## Automation Options (Future)

### Build Process
- **Current:** Netlify builds (300 min/month free)
- **Alternative:** GitHub Actions builds (2,000 min/month free) → deploy via Netlify API
- Stop Netlify auto-builds, use Actions for more build minutes

### Provisioning New Sites

| Method | Pros | Cons |
|--------|------|------|
| **Manual (UI)** | Simple | Slow, error-prone |
| **Netlify CLI** | Scriptable | Still some manual steps |
| **Netlify API** | Full automation | More setup |
| **Terraform** | Declarative, state managed | Identity not supported yet |

### Netlify API Coverage

```
✅ Create site          POST /sites
✅ Deploy files         netlify deploy CLI
✅ Enable Identity      PUT /sites/{id}/identity
✅ Invite users         POST /sites/{id}/identity/users
✅ Git Gateway          PUT /sites/{id}/identity (with git_gateway config)
✅ Custom domains       POST /sites/{id}/domains
```

### Terraform

Official provider exists but **doesn't support Identity/Git Gateway yet**.

Workarounds:
- `null_resource` + `local-exec` (curl the API)
- `terraform-provider-restapi` (generic REST provider)
- Custom Go provider (if scaling big)

---

## Decisions Made

| Decision | Choice |
|----------|--------|
| CMS | Decap + Netlify Identity |
| Hosting | Netlify (one account, all sites) |
| Repos | GitHub org (yours) |
| Generator | 11ty |
| Styling | Tailwind v4 |
| Content format | `site.json` (single file) |
| Auth for clients | Email/password or Google (not GitHub) |
| Client isolation | ✅ Identity is per-site |
| Build process | Consider GitHub Actions for more minutes |
